<?xml version="1.0" encoding="utf-8"?>
<templates xml:space="preserve">
    <t t-name="kanbanagent">
        <head>
            <meta charset="UTF-8"/>
            <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
            <title>Kanban Agent</title>
        </head>
        <body>
            <t t-if="state.accessDenied">
                <div style="text-align: center; padding: 50px; font-size: 18px; color: #d9534f;">
                    <i class="fa fa-exclamation-triangle"/>
                    Acc√®s r√©serv√© aux agents uniquement.
                    <div t-if="state.userInfo">
                        <small>Connect√© en tant que: <t t-esc="state.userInfo.username"/></small>
                    </div>
                </div>
            </t>
            <t t-else="">
                <div class="nodno">
                    <table style="width: 100%; border-collapse: collapse; vertical-align: middle; border: none; border-collapse: collapse; background: transparent;">
                        <tr>
                            <td style="padding: 8px;">
                                <h2 style="margin: 0;">
                                    <t t-esc="state.currentDate"/>
                                    <span style="font-weight: normal; color: #666;">
                                        (<t t-esc="state.operationsCount"/>
                                        op√©rations)
                                    </span>
                                </h2>
                            </td>
                            <td style="padding: 8px;" invisible="1">
                                <label for="search-date" style="margin-right: 20px;">Date :</label>
                                <input type="date" id="search-date" size="10" readonly="readonly"
                                       t-on-change="updateSelectedDate"/>
                            </td>
                            <td style="text-align: right; padding: 8px;">
                                <img src="https://i.ibb.co/fd5zQ5m4/cartedevisitenew.png" alt="logo"
                                     style="width: 180px;"/>
                            </td>
                        </tr>
                    </table>

                    <button class="btn-print" style="font-size: 1rem;"
                            t-on-click="printReservations">- üñ®Ô∏è Imprimer -</button>

                    <div class="card-container">
    <t t-foreach="state.filteredReservations" t-as="reservation" t-key="reservation_index">
        <div class="entry" t-on-click="() => this.openReservationForm(reservation.id)">
            <div t-att-class="reservation.lv_type === 'livraison' ? 'entry-icon green' : 'entry-icon red'">
                <t t-esc="reservation.lv_type === 'livraison' ? 'D' : 'R'"/>
            </div>

            <div class="entry-info">
                <!-- Ligne 1 : Date -->
                <div class="entry-time">
    <t t-if="reservation.vehicule and reservation.vehicule[1]">
        <t t-if="reservation.lv_type === 'livraison' and reservation.date_heure_debut">
            <!-- Cas livraison : affiche date_heure_debut -->
            <t t-esc="formatDateTime(reservation.date_heure_debut) + ' (' + reservation.vehicule[1] + ')'"/>
        </t>
        <t t-elif="reservation.lv_type === 'restitution' and reservation.date_heure_fin">
            <!-- Cas restitution : affiche date_heure_fin -->
            <t t-esc="formatDateTime(reservation.date_heure_fin) + ' (' + reservation.vehicule[1] + ')'"/>
        </t>
    </t>
</div>
                <t t-if="reservation.stage === 'livre' and reservation.livrer_par and reservation.livrer_par[1]">
<!--    <div style="display: flex; flex-direction: row; justify-content: start; margin-top: 10px;">-->
<!--        <div class="icon">-->
<!--            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" color="white">-->
<!--                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="white"/>-->
<!--            </svg>-->
<!--        </div>-->
<!--&lt;!&ndash;        <span style="font-size: 14px; font-style: italic; justify-content: center; text-align: left; padding-top: 2px; color: #555;">&ndash;&gt;-->
<!--&lt;!&ndash;            <span style="color:#6a8fae; font-weight:bold;">&ndash;&gt;-->
<!--&lt;!&ndash;                <t t-esc="reservation.create_date and formatDateTime(reservation.create_date)"/>&ndash;&gt;-->
<!--&lt;!&ndash;            </span>&ndash;&gt;-->
<!--&lt;!&ndash;            par&ndash;&gt;-->
<!--&lt;!&ndash;            <t t-esc="reservation.livrer_par[1]"/>&ndash;&gt;-->
<!--&lt;!&ndash;        </span>&ndash;&gt;-->
<!--    </div>-->
</t>                <!-- Ligne 2 : Lieu D√©part/Retour -->
                <div class="entry-place">
    <t t-if="reservation.lieu_depart and reservation.lieu_depart[1] and reservation.duree_dereservation">
        <t t-esc="reservation.lieu_depart[1] + ' (' + reservation.duree_dereservation + ')'"/>
    </t>
</div>


                <!-- Ligne 3 : Matricule -->
                <div class="entry-veh">
                    <t t-if="reservation.matricule">
                        <t t-esc="reservation.matricule"/>
                    </t>
                </div>


                <!-- Ligne 4 : Options -->
                <div class="entry-options" style="font-size: 13px; color: #444;">
    <t t-set="options" t-value="[]"/>
                    <t t-if="reservation.opt_protection"> <t t-set="options"
                                                             t-value="options.concat([reservation.opt_protection])"/> </t>
                    <t t-if="reservation.opt_carburant"> <t t-set="options"
                                                            t-value="options.concat([reservation.opt_carburant])"/> </t>
                    <!--                    <t t-if="reservation.siege_bebe"> <t t-set="options"-->
                    <!--                                                         t-value="options.concat([reservation.siege_bebe])"/> </t>-->

                    <t t-if="options.length > 0">
        Options : <t t-esc="options.join(', ')"/>
    </t>
                    <t t-if="options.length === 0">
        Options : -
    </t>
</div>
                <!-- D√©tails de livraison -->
                <t t-if="reservation.stage === 'livre' and reservation.livrer_par and reservation.livrer_par[1]">
    <div style="display: flex; flex-direction: row; justify-content: start; margin-top: 10px;">
        <div class="icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" color="white">
                <path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z" fill="white"/>
            </svg>
        </div>
        <span style="font-size: 14px; font-style: italic; justify-content: center; text-align: left; padding-top: 2px; color: #555;">
            <span style="color:#6a8fae; font-weight:bold;">
                <t t-esc="reservation.create_date and formatDateTime(reservation.create_date)"/>
            </span>
            par
            <t t-esc="reservation.livrer_par[1]"/>
        </span>
    </div>
</t>            </div>
            <div>&#x276F;</div>
        </div>
    </t>
</div>
                    <div class="footer-nav">
    <button t-att-disabled="isDateNavigationDisabled(-1)" t-on-click="() => this.changeDate(-1)">Jour pr√©c.</button>
                        <button class="active-date">
        <t t-esc="state.formattedActiveDate"/>
    </button>
                        <button t-att-disabled="isDateNavigationDisabled(1)" t-on-click="() => this.changeDate(1)">Jour suiv.</button>
</div>                </div>
            </t>
        </body>
    </t>
</templates>