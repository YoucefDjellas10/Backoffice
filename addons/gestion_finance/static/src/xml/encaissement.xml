<?xml version="1.0" encoding="utf-8"?>
<templates>
    <t t-name="EncaissementTree" owl="1">
        <head>
            <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
            <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"></link>
            <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700display=swap" rel="stylesheet"></link>
            <meta charset="UTF-8" />
            <title>Récap des Encaissements</title>
        </head>

        <body>
            <div class="balance-container">
                <div class="main-container">
                    <div class="container-fluid">


                        <div class="filters-section">
                            <div class="row g-3">
                                <!-- Première ligne - Réservation / Zone / Du -->
                                <div class="col-md-4">
                                    <div class="filter-label">Réservation</div>
                                    <input type="text" id="reservation" class="filter-select" placeholder="Référence réservation"/>
                                </div>

                                <div class="col-md-4">
                                    <div class="filter-label">Zone</div>
                                    <select id="zone" class="filter-select">
                                        <option value="">Toutes les zones</option>
                                        <t t-foreach="state.zones" t-as="zone" t-key="zone.id">
                                            <option t-att-value="zone.id" t-esc="zone.name"/>
                                        </t>
                                    </select>
                                </div>

                                <div class="col-md-4">
                                    <div class="filter-label">Du</div>
                                    <input type="date" id="du" class="filter-select" t-att-value="state.defaultDuDate"/>
                                </div>

                                <!-- Deuxième ligne - Au / Véhicule / Mode de paiement / Effectué par -->
                                <div class="col-md-3">
                                    <div class="filter-label">Au</div>
                                    <input type="date" id="au" class="filter-select" t-att-value="state.defaultAuDate"/>
                                </div>

                                <div class="col-md-3">
                                    <div class="filter-label">Véhicule</div>
                                    <select id="vehicule" class="filter-select">
                                        <option value="">Tous les véhicules</option>
                                        <t t-foreach="state.vehicules" t-as="veh" t-key="veh.id">
                                            <option t-att-value="veh.id" t-esc="veh.name"/>
                                        </t>
                                    </select>
                                </div>

                                <div class="col-md-3">
                                    <div class="filter-label">Mode de paiement</div>
                                    <select id="mode_paiement" class="filter-select">
                                        <option value="">Tous</option>
                                        <option value="carte">Banque</option>
                                        <option value="liquide">Liquide</option>
                                        <option value="autre">Autre</option>
                                    </select>
                                </div>

                                <div class="col-md-3">
                                    <div class="filter-label">Effectué par</div>
                                    <select id="effectue_par" class="filter-select">
                                        <option value="">Tous</option>
                                        <t t-foreach="state.users" t-as="u" t-key="u.id">
                                            <option t-att-value="u.id" t-esc="u.name"/>
                                        </t>
                                    </select>
                                </div>
                            </div>

                            <!-- Ligne des résultats et boutons - CORRIGÉE -->
<div class="filter-buttons">
    <div class="filter-label">
        <span>
            <span style="font-size: 17px; ">
                Total : <t t-esc="state.totalMontantDzd.toLocaleString('fr-FR')"/> DA
                | <t t-esc="state.totalMontantEur.toLocaleString('fr-FR')"/> €
            </span>
        </span>
    </div>
    <div style="display: flex; gap: 10px;">
        <button class="butn123" t-on-click="searchRevenues">
            Rechercher
        </button>
        <button class="butn123" t-on-click="resetFilters">
            Rétablir
        </button>
    </div>
</div>
                        </div>

                        <!-- Tableau principal -->
                        <div class="annual-table-wrapper">
                            <table class="annual-table">
                                <thead>
                                    <tr>
                                        <th style="text-align: left;">Référence</th>
                                        <th>Créé le</th>
                                        <th>Mode de paiement</th>
                                        <th>Montant €</th>
                                        <th>Montant DA</th>
                                        <th>Effectué par</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="state.revenues" t-as="rev" t-key="rev.id">
                                        <tr>
                                            <td t-esc="rev.reservation_ref"/>
                                            <td t-esc="rev.create_date"/>
                                            <td t-esc="rev.mode_paiement"/>
                                            <td style="color: #27ae60; font-weight: 600;" t-esc="rev.montant_eur"/>
                                            <td style="color: #27ae60; font-weight: 600;" t-esc="rev.montant_dzd"/>
                                            <td t-esc="rev.effectuer_par"/>
                                        </tr>
                                    </t>
                                    <tr t-if="state.revenueCount === 0">
                                        <td colspan="6" style="text-align:center">Aucun encaissement trouvé</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>

                        <!-- Pagination -->
                        <div class="pagination-controls" t-if="state.totalPages > 1">
                            <div class="items-per-page">
                                <select class="filter-select" t-on-change="changeItemsPerPage" style="width: auto;">
                                    <option value="10">10</option>
                                    <option value="30" selected="selected">30</option>
                                    <option value="50">50</option>
                                    <option value="100">100</option>
                                </select>
                            </div>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <button class="butn123 pagination-btn search-btn" t-on-click="prevPage" t-att-disabled="state.currentPage === 1">
                                    ‹
                                </button>
                                <span class="page-info">
                                    Page <t t-esc="state.currentPage"/> sur <t t-esc="state.totalPages"/>
                                </span>
                                <button class="butn123 pagination-btn search-btn" t-on-click="nextPage" t-att-disabled="state.currentPage === state.totalPages">
                                    ›
                                </button>
                            </div>
                        </div>

                    </div>
                </div>
            </div>
        </body>

        <style>
            /* ✅ Même style CSS que balance.xml */
            .o_action_manager .o_action > div {
                height: 100%;
            }

            .balance-container {
                font-family: 'Poppins', sans-serif !important;
                background: linear-gradient(130deg,#6770b7, #cab1d9) !important;
                min-height: 100%;
                height: 100%;
                overflow-y: auto !important;
                padding: 20px 0 40px 0;
                position: relative;
                width: 100%;
            }

            .balance-container::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: url('https://i.ibb.co/ZR4bt0Cw/6f09b0e8-6820-4ac0-bedd-5797e92814c18.jpg') center/cover no-repeat;
                opacity: 0.15;
                z-index: 0;
                pointer-events: none;
            }

            .balance-container .main-container {
                position: relative;
                z-index: 1;
            }

            .balance-container .header-section {
                text-align: center;
                margin-bottom: 30px;
                padding: 30px 20px;
                background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(255,255,255,0.85) 100%) !important;
                border-radius: 20px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.15);
                backdrop-filter: blur(10px);
                animation: fadeInDown 0.8s ease;
            }

            @keyframes fadeInDown {
                from { opacity: 0; transform: translateY(-30px); }
                to { opacity: 1; transform: translateY(0); }
            }

            .balance-container .balance-title {
                font-weight: 700;
                background: linear-gradient(-135deg, #406085 0%, #65748B 100%);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
                font-size: 48px;
                margin-bottom: 10px;
                letter-spacing: 2px;
                text-transform: uppercase;
            }

            .balance-container .sub-title {
                color: #5f6368;
                font-size: 18px;
                font-weight: 400;
                letter-spacing: 1px;
            }

            /* ✅ Section Filtres */
            .balance-container .filters-section {
                background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(236,245,252,0.9) 100%) !important;
                border-radius: 16px;
                padding: 24px;
                margin-bottom: 30px;
                border: 2px solid rgba(255,255,255,0.5);
                box-shadow: 0 8px 32px rgba(31,38,135,0.15);
                backdrop-filter: blur(8px);
                animation: fadeInUp 0.6s ease;
            }

            @keyframes fadeInUp {
                from { opacity: 0; transform: translateY(30px); }
                to { opacity: 1; transform: translateY(0); }
            }

            .balance-container .filter-label {
                font-weight: 600;
                color: #406085;
                margin-bottom: 8px;
                font-size: 14px;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .balance-container .filter-select {
                width: 100%;
                padding: 10px 15px;
                border: 2px solid rgba(103,112,183,0.2);
                border-radius: 8px;
                font-size: 15px;
                background: white;
                transition: all 0.3s ease;
                font-family: 'Poppins', sans-serif;
            }

            .balance-container .filter-select:focus {
                outline: none;
                border-color: #6770b7;
                box-shadow: 0 0 0 3px rgba(103,112,183,0.1);
            }

            /* ✅ Boutons Rechercher et Rétablir - CORRIGÉS */
            .balance-container .filter-buttons {
                display: flex;
                gap: 10px;
                justify-content: space-between;
                margin-top: 20px;
                align-items: center;
            }

            .balance-container .resulspan {
                flex-grow: 1;
                text-align: left;
            }

            .balance-container .butn123 {
                padding: 10px 24px;
                border: none;
                border-radius: 8px;
                font-size: 15px;
                font-weight: 600;
                cursor: pointer;
                transition: all 0.3s ease;
                font-family: 'Poppins', sans-serif;
                text-transform: uppercase;
                letter-spacing: 0.5px;
                color: white;
            }

            /* ✅ Couleurs des boutons comme dans le deuxième fichier */
            .balance-container .search-btn {
                background: linear-gradient(135deg, #406085 0%, #535da9 100%);
            }

            .balance-container .reset-btn {
                background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            }

            .balance-container .butn123:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(64,96,133,0.3);
            }

            /* ✅ Tableau style */
            .balance-container .annual-table-wrapper {
                background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(236,245,252,0.9) 100%) !important;
                border-radius: 16px;
                padding: 24px;
                border: 2px solid rgba(255,255,255,0.5);
                box-shadow: 0 8px 32px rgba(31,38,135,0.15);
                backdrop-filter: blur(8px);
                overflow-x: auto;
            }

            .balance-container .annual-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 20px;
            }

            .balance-container .annual-table th {
                background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
                color: white;
                padding: 15px;
                text-align: center;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 1px;
                border: 2px solid #1a252f;
                font-size: 15px;
            }

            .balance-container .annual-table td {
                padding: 12px 15px;
                text-align: center;
                border: 2px solid #d0d7de;
                background: rgba(255,255,255,0.8);
                font-size: 14px;
                font-weight: 500;
                transition: all 0.2s ease;
            }

            .balance-container .annual-table td:first-child {
                font-weight: 600;
                background: rgba(103,112,183,0.1);
                color: #406085;
                text-align: left;
                padding-left: 20px;
            }

            .balance-container .annual-table tr:hover td {
                background: rgba(103,112,183,0.15);
            }

            /* Pagination */
            .balance-container .pagination-controls {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 20px;
                padding: 15px;
                background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(236,245,252,0.9) 100%);
                border-radius: 16px;
                border: 2px solid rgba(255,255,255,0.5);
            }

            .balance-container .pagination-btn {
                padding: 8px 16px;
            }

            .balance-container .page-info {
                font-weight: 600;
                color: #406085;
            }

            /* Responsive */
            @media (max-width: 768px) {
                .balance-container .balance-title { font-size: 36px; }
                .balance-container .sub-title { font-size: 16px; }
                .balance-container .filters-section { padding: 20px; }
                .balance-container .annual-table th,
                .balance-container .annual-table td {
                    padding: 10px 8px;
                    font-size: 13px;
                }
                .balance-container .filter-buttons {
                    flex-direction: column;
                    gap: 15px;
                }
                .balance-container .resulspan {
                    text-align: center;
                }
            }

            @media (max-width: 576px) {
                .balance-container { padding: 10px 0 30px 0; }
                .balance-container .balance-title { font-size: 28px; }
                .balance-container .filters-section { padding: 16px; }
                .balance-container .annual-table-wrapper { padding: 16px; }
                .balance-container .annual-table th,
                .balance-container .annual-table td {
                    padding: 8px 5px;
                    font-size: 12px;
                }
            }
        </style>
    </t>
</templates>
