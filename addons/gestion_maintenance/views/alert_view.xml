<odoo>
    <!-- Tree View -->
    <record id="view_alert_record_tree" model="ir.ui.view">
        <field name="name">alert.record.tree</field>
        <field name="model">alert.record</field>
        <field name="arch" type="xml">
            <tree string="Alert">
                <field name="reference_id"/>
                <field name="type_maintenance_id" decoration-bf="1"/>
                <field name="numero" widget="badge"/>
                <field name="echeance"/>
            </tree>
        </field>
    </record>

    <!-- Form View -->
    <record id="view_alert_record_form" model="ir.ui.view">
        <field name="name">alert.record.form</field>
        <field name="model">alert.record</field>
        <field name="arch" type="xml">
            <form string="Alert">
                <header>
                    <button name="action_create_maintenance_record" type="object" string="Réaliser"
                            class="oe_highlight btn-success"/>
                    <button name="action_verifier" type="object" string="Vérifier"
                            class="oe_highlight btn-info"/>
                </header>
                <sheet>
                    <group>
                        <groupe>
                            <group class="custom-group">
                                <field name="status" readonly="1"/>
                                <field name="date_prochaine_alerte" readonly="1"/>
                                <field name="vehicule_id" readonly="1"/>
                                <field name="km_actuel" context="{'show_km_actuel': True}"/>

                                <field name="zone" readonly="1"/>
                                <field name="maintenance_created" readonly="1"/>

                            </group>
                        </groupe>
                        <group class="custom-group">
                            <field name="type_maintenance_id" readonly="1"/>
                            <field name="echeance" readonly="1"/>
                            <field name="manager" readonly="1"/>
                            <field name="agent" readonly="1" widget="many2many_tags"/>

                        </group>
                    </group>
                </sheet>
            </form>
        </field>
    </record>

    <record id="view_alert_record_calendar" model="ir.ui.view">
        <field name="name">alert.record.calendar</field>
        <field name="model">alert.record</field>
        <field name="arch" type="xml">
            <calendar string="Alert Calendar" date_start="date_prochaine_alerte" mode="month" color="maintenance_id">
                <field name="date_prochaine_alerte"/>
                <field name="vehicule_id"/>
                <field name="zone" filters="1"/>
                <field name="maintenance_id"/>
                <field name="type_maintenance_id"/>
            </calendar>
        </field>
    </record>

    <record id="view_alert_record_search" model="ir.ui.view">
        <field name="name">alert.record.search</field>
        <field name="model">alert.record</field>
        <field name="arch" type="xml">
            <search string="Search Alert Records">
                <filter name="filter_maintenance_created" string="Résolu"
                        domain="[('maintenance_created', '=', True)]"/>
                <filter name="filter_maintenance_not_created" string="En attente"
                        domain="[('maintenance_created', '=', False)]"/>
                <separator/>

                <filter name="ouest" string="OUEST" domain="[('zone', '=', 1)]"/>
                <filter name="centre" string="CENTRE" domain="[('zone', '=', 2)]"/>
                <filter name="est" string="EST" domain="[('zone', '=', 3)]"/>
                <separator/>
                <filter string="Aujourd'hui" name="today" domain="[('date_prochaine_alerte', '=', context_today())]"/>
                <filter string="Cette semaine" name="this_week"
                        domain="[('date_prochaine_alerte', '&gt;=', context_today()), ('date_prochaine_alerte', '&lt;=', (context_today() + datetime.timedelta(days=7)))]"/>
                <filter string="Ce mois" name="this_month"
                        domain="[('date_prochaine_alerte', '&gt;=', context_today().replace(day=1)), ('date_prochaine_alerte', '&lt;=', (context_today().replace(day=1) + relativedelta(months=+1, days=-1)))]"/>
                <group expand="0" string="Group By">
                    <filter string="Zone" name="group_zone" context="{'group_by':'zone'}"/>
                    <filter string="Vehicule" name="group_vehicule" context="{'group_by':'vehicule_id'}"/>
                    <filter string="Type Maintenance" name="group_type_maintenance"
                            context="{'group_by':'type_maintenance_id'}"/>
                </group>
            </search>

        </field>
    </record>
    <record id="alert_agent_rule" model="ir.rule">
        <field name="name">Restriction d'accès aux alerts par zone pour les agents</field>
        <field name="model_id" ref="gestion_maintenance.model_alert_record"/>
        <field name="groups" eval="[(4, ref('access_rights_groups.group_agent'))]"/>
        <field name="domain_force">[('zone', 'in', user.zone_ids.ids)]</field>
    </record>


    <!-- Action -->
    <record id="action_alert_record" model="ir.actions.act_window">
        <field name="name">Alert</field>
        <field name="res_model">alert.record</field>
        <field name="view_mode">tree,calendar,form</field>
        <field name="search_view_id" ref="view_alert_record_search"/>
        <field name="context">{'search_default_filter_maintenance_not_created': 1}</field>

    </record>

    <!-- Menu Item -->
    <menuitem id="menu_alert_record"
              name="Alert"
              sequence="0"
              parent="maintenance_menu_root"
              action="action_alert_record"
              groups="access_rights_groups.group_admin,access_rights_groups.group_ceo,access_rights_groups.group_agent"/>
</odoo>
